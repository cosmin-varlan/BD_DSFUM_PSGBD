<p>Tematica: </p>
<ul>
<li>gruparea Ã®nregistrÄƒrilor</li>
<li>aplicarea funcÈ›iilor de agregare</li>
</ul>


<h2>FuncÅ£ii de agregare Ã®n SQL</h2>

<p>FuncÅ£iile de agregare sunt funcÅ£ii care, utilizate Ã®n interogÄƒri, returneazÄƒ o singurÄƒ linie rezultat pe baza unui grup de linii. Pot fi utilizate Ã®n cadrul listei SELECT ÅŸi Ã®n clauzele ORDER BY ÅŸi HAVING.</p>

<p>ATENÈšIE: nu utilizaÈ›i funcÈ›iile de agregare Ã®n clauza WHERE !!!</p>



<p>FuncÅ£iile de agregare pot accepta clauzele</p>
<ul>
<li>DISTINCT â€“ specificÄƒ luarea Ã®n considerare doar a valorilor distincte de cÄƒtre funcÅ£ie</li>
<li>ALL â€“ este implicit, determinÄƒ funcÅ£ia de agregare sa calculeze rezultatul pe baza tuturor valorilor</li>
</ul>


<p>{| border="1"</p>
<p>|-</p>
<p>|<pre>COUNT ({ *|[DISTINCT|ALL] expr})</pre>	||ReturneazÄƒ numÄƒrul de linii.  DacÄƒ argumentul este * se numÄƒrÄƒ ÅŸi valorile NULL, altfel se numÄƒrÄƒ doar valorile nenule. Argumentul poate lua tipul CHAR, VARCHAR2, NUMBER, DATE.	||SELECT COUNT(*) AS "Total studenti" FROM studenti;</p>

<p>SELECT COUNT(NVL(bursa,0)) AS "Total studenti" FROM studenti;</p>

<p>SELECT COUNT(bursa) AS "Studenti bursieri" FROM studenti;</p>

<p>SELECT COUNT(DISTINCT bursa) AS "Variante bursa" FROM studenti;</p>
<p>|-</p>
<p>|<pre>AVG ([DISTINCT|ALL]n)</pre>	||ReturneazÄƒ media valorilor. Argumentul trebuie sÄƒ fie numeric.	||SELECT AVG(valoare) FROM note;</p>
<p>|-</p>

<p>|<pre>MAX ([DISTINCT|ALL]expr)</pre></p>
<p>	||ReturneazÄƒ valoare maximÄƒ. Argumentul poate lua tipul CHAR, VARCHAR2, NUMBER, DATE	||SELECT MAX(bursa) FROM studenti;</p>
<p>|-</p>
<p>|<pre>MIN ([DISTINCT|ALL]expr)</pre>||ReturneazÄƒ valoare minimÄƒ. Argumentul poate lua tipul CHAR, VARCHAR2, NUMBER, DATE	||SELECT MIN(bursa) FROM studenti;</p>
<p>|-</p>
<p>|<pre>STDDEV ([DISTINCT|ALL]x)</pre>||ReturneazÄƒ deviatia standard a valorilor. Argumentul trebuie sÄƒ fie numeric.	||SELECT STDDEV(bursa) AS "Deviatie standard" FROM studenti;</p>
<p>|-</p>
<p>|<pre>VARIANCE ([DISTINCT|ALL]x)</pre>||ReturneazÄƒ varianÅ£a valorilor. Argumentul trebuie sÄƒ fie numeric.	||SELECT VARIANCE(bursa) AS "Varianta" FROM studenti;</p>
<p>|-</p>
<p>|<pre>SUM([DISTINCT|ALL]n)</pre>	||ReturneazÄƒ suma valorilor. Argumentul trebuie sÄƒ fie numeric.	||SELECT SUM(bursa) FROM studenti;</p>
<p>|}</p>

<p>Toate funcÅ£iile de agregare ignorÄƒ valorile NULL. ExcepÅ£ie face funcÅ£ia COUNT cu argumentul * care va considera NULL ca fiind o valoare distinctÄƒ. Pentru ca valoarea NULL sÄƒ fie luatÄƒ Ã®n considerare se poate utiliza NVL Ã®n cadrul funcÅ£iei de agregare pentru a substitui NULL cu o valoare anume (ex. 0).</p>

<p>DacÄƒ setul de date nu conÅ£ine linii sau conÅ£ine doar linii cu valori NULL ca argumente a funcÅ£iilor de agregare, funcÅ£ia va returna NULL. ExcepÅ£ie face COUNT care returneazÄƒ 0 sau un alt numÄƒr.</p>
<p><!--</p>
<p>Cum se calculeaza varianta:</p>
<ul>
<li> pas1: se face media numerelor </li>
<li> pas2: din fiecare valoare se scade media si se ridica la patrat rezultatul</li>
<li> pas3: se face media valorilor obtinute la pasul 2</li>
</ul>


<p>Cum se calculeaza deviatia medie:</p>
<ul>
<li> pas4: se face radical din varianta (din ce am obtinut la pasul 3)</li>
</ul>


<p>--></p>

<h2>Gruparea datelor</h2>
<p>Toate exemplele ilustrate anterior aplicÄƒ funcÈ›iile de agregare asupra intregului conÈ›inut al tabelului, rezultatul interogÄƒrii fiind alcÄƒtuit dintr-o singurÄƒ linie.</p>

<p>FuncÈ›iile de agregare sunt Ã®nsa utilizate Ã®n general Ã®mpreunÄƒ cu clauza GROUP BY care specificÄƒ Ã®mpÄƒrÅ£irea liniilor tabelului interogat Ã®n mai multe grupuri; Oracle aplicÄƒ funcÅ£iile de agregare fiecÄƒrui astfel de grup returnÃ¢nd un singur rezultat pentru fiecare grup. </p>

<p>Reamintim sintaxa interogÄƒrii Ã®n Oracle:</p>
<pre><code class="language-sql">SELECT [DISTINCT | ALL] {* | [expresie_coloana [AS nume_nou]] [,...] }
   FROM nume_tabel [alias] [, ...]
   [WHERE conditie]
   [GROUP BY expresie [HAVING conditie] ]
   [ORDER BY expresie1 [ASC|DESC][,â€¦]]


<p>Exemplu:</p>
<pre><code class="language-sql">SELECT MAX(valoare) 
    FROM note
    GROUP BY nr_matricol;
--CÃ¢te linii sunt returnate? Ce reprezintÄƒ fiecare linie?



<p>Valori individuale nu pot fi utilizate Ã®n lista select decÃ¢t dacÄƒ Ã®n clauzÄƒ GROUP BY este specificatÄƒ coloana individualÄƒ. Deci toate cÃ¢mpurile din lista select care nu sunt utilizate Ã®n cadrul funcÅ£iilor de agregare trebuie sÄƒ aparÄƒ Ã®n clauza GROUP BY.</p>

<p>Exemplu:</p>
<pre><code class="language-sql">SELECT MAX(valoare), id_curs
    FROM note
    GROUP BY nr_matricol;
--De ce nu merge?

<p>Grupurile pot fi create È™i pe baza mai multor atribute:</p>
<p>Exemplu:</p>
<pre><code class="language-sql">SELECT an, count(*)
    FROM cursuri
    GROUP BY an;
--Cate grupuri?

SELECT credite, count(*)
    FROM cursuri
    GROUP BY credite;
--Cate grupuri?

SELECT an, credite, count(*)
    FROM cursuri
    GROUP BY an, credite
    ORDER BY an, credite;
--Cate grupuri?
<p>Nu este obligatoriu ca atributele utilizate in clauza GROUP BY sÄƒ aparÄƒ Ã®n lista select; este Ã®nsÄƒ indicatÄƒ includerea acestora pentru ca Ã®nregistrÄƒrile rezultat sÄƒ poatÄƒ fi interpretate.</p>

<h2>Filtrarea grupurilor</h2>

<p>Clauza WHERE eliminÄƒ valori individuale (linii) Ã®nainte de a avea loc gruparea. </p>

<p>Clauza HAVING este utilizatÄƒ doar Ã®n conjuncÅ£ie cu clauza GROUP BY avÃ¢nd rolul de a elimina unele grupuri pe baza rezultatului funcÅ£iilor de agregare ÅŸi nu a valorilor individuale ale liniilor.</p>

<p>Exemplu:</p>
<pre><code class="language-sql">SELECT id_curs, COUNT(valoare)
   FROM note
   GROUP BY id_curs;
--Cate grupuri?

SELECT id_curs, COUNT(valoare)
   FROM note
   WHERE valoare>8
   GROUP BY id_curs;
--Cate grupuri? De ce?

SELECT id_curs, COUNT(valoare)
   FROM note
   GROUP BY id_curs
   HAVING COUNT(valoare)>8;
--Cate grupuri? De ce?

<h2>ExerciÈ›ii</h2>
<p>#AfiÈ™aÈ›i numÄƒrul de studenÈ›i din fiecare an.</p>
<p>#AfiÈ™aÈ›i numÄƒrul de studenÈ›i din fiecare grupÄƒ a fiecÄƒrui an de studiu. OrdonaÈ›i crescÄƒtor dupÄƒ anul de studiu È™i dupÄƒ grupÄƒ.</p>
<p>#AfiÈ™aÈ›i numÄƒrul de studenÈ›i din fiecare grupÄƒ a fiecÄƒrui an de studiu È™i specificaÈ›i cÃ¢È›i dintre aceÈ™tia sunt bursieri.</p>
<p>#AfiÈ™aÈ›i suma totalÄƒ cheltuitÄƒ de facultate pentru acordarea burselor.</p>
<p>#AfiÈ™aÈ›i valoarea bursei/cap de student (se considerÄƒ cÄƒ studentii care nu sunt bursieri primesc 0 RON); altfel spus: cÃ¢t se cheltuieÈ™te Ã®n medie pentru un student?</p>
<p>#AfiÈ™aÈ›i numÄƒrul de note de fiecare fel (cÃ¢te note de 10, cÃ¢te de 9,etc.). OrdonaÈ›i descrescÄƒtor dupÄƒ valoarea notei.</p>
<p>#AfiÈ™aÈ›i numÄƒrul de note pus Ã®n fiecare zi a sÄƒptÄƒmÃ¢nii. OrdonaÈ›i descrescÄƒtor dupÄƒ numÄƒrul de note.</p>
<p>#AfiÈ™aÈ›i numÄƒrul de note pus Ã®n fiecare zi a sÄƒptÄƒmÃ¢nii. OrdonaÈ›i crescÄƒtor dupÄƒ ziua saptamanii: Sunday, Monday, etc.</p>
<p>#AfiÈ™aÈ›i pentru fiecare elev care are mÄƒcar o notÄƒ, numele È™i media notelor sale. OrdonaÈ›i descrescÄƒtor dupÄƒ valoarea mediei.</p>
<p>#ModificaÈ›i interogarea anterioarÄƒ pentru a afiÈ™a È™i elevii fÄƒrÄƒ nici o notÄƒ. Media acestora va fi null.</p>
<p>#ModificaÈ›i interogarea anterioarÄƒ pentru a afiÈ™a pentru elevii fÄƒrÄƒ nici o notÄƒ media 0.</p>
<p>#Modificati interogarea de mai sus pentru a afisa doar studentii cu media mai mare ca 8.</p>
<p>#AfiÈ™aÈ›i numele, cea mai mare notÄƒ, cea mai micÄƒ notÄƒ È™i media doar pentru acei studenti care au primit doar note mai mari sau egale cu 7 (au cea mai micÄƒ notÄƒ mai mare sau egalÄƒ cu 7).</p>
<p>#AfiÈ™aÈ›i numele È™i mediile studenÈ›ilor care au cel puÈ›in un numÄƒr de 3 note puse Ã®n catalog.</p>
<p>#AfiÈ™aÈ›i numele È™i mediile studenÈ›ilor care au cel puÈ›in un numÄƒr de 3 note diferite puse Ã®n catalog.</p>
<p>#AfiÈ™aÈ›i numele È™i mediile studenÈ›ilor din grupa A2 anul 3.</p>
<p>#AfiÈ™aÈ›i cea mai mare medie obÈ›inutÄƒ de vreun student. PuteÈ›i sÄƒ afiÈ™aÈ›i È™i numÄƒrul matricol al studentului care are acea medie maximalÄƒ ? ArgumentaÈ›i.</p>
<p><!--#Pentru fiecare disciplinÄƒ de studiu afiÈ™ati titlul acesteia, cea mai micÄƒ È™i cea mai mare notÄƒ pusÄƒ.--></p>
<p>#Un profesor este iubit de studenti daca pune note mai mari (adica media notelor sale este mai mare). Afisati toti profesorii in ordinea preferintelor studentilor impreuna cu mediile notelor puse de ei scrise cu doua zecimale . </p>
<p>#Afisati numarul de restantieri generati de <b>FIECARE</b> profesor (tip: 1 cu 2 restantieri, 4 cu 1 restantier, 11 cu 0 restantieri) ğŸ˜ˆ </p>

<p><!--</p>
<p>select nume, prenume, 0 from profesori</p>
<p>minus</p>
<p>SELECT NUME, PRENUME, 0 FROM PROFESORI LEFT JOIN DIDACTIC ON DIDACTIC.ID_PROF=PROFESORI.ID_PROF LEFT JOIN NOTE ON NOTE.ID_CURS=DIDACTIC.ID_CURS WHERE VALOARE<=4 GROUP BY NUME, PRENUME, VALOARE</p>
<p>UNION</p>
<p>SELECT NUME, PRENUME, NVL(COUNT(VALOARE),0) FROM PROFESORI LEFT JOIN DIDACTIC ON DIDACTIC.ID_PROF=PROFESORI.ID_PROF LEFT JOIN NOTE ON NOTE.ID_CURS=DIDACTIC.ID_CURS WHERE VALOARE<=4 GROUP BY NUME, PRENUME, VALOARE</p>
<p>--></p>




<p><!--</p>
<p>Tematica: </p>
<p># operatori Ã®n algebra relaÈ›ionalÄƒ</p>
<p># dependenÈ›e funcÈ›ionale È™i multivaluate</p>

<p>[https://profs.info.uaic.ro/~vcosmin/bd Curs]</p>

<h2>ExerciÈ›ii</h2>
<p># [https://profs.info.uaic.ro/~vcosmin/pagini/resurse_bd/probleme_algebra_relationala.pdf Exercitii Algebra Relationala]</p>
<p># [https://profs.info.uaic.ro/~vcosmin/bd 4 exercitii (DF, chei, inchidere)]</p>
<p># Pentru primele trei exercitii propuse la laboratorul numarul 4 determinati dependentele functionale din tabelele obtinute in urma operatiilor de tip JOIN.</p>
<p># Modificati o tabela (de exemplu profesori) pentru a obtine in cadrul ei dependente multivaluate.</p>
<p>--></p>
